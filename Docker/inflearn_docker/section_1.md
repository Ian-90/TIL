## 1. 도커를 쓰는 이유
* 도커를 사용하지 않으면 ?
  * 서버, 패키지 버전, 운영체제 등에 따라 프로그램을 설치하는 과정중에 많은 에러들이 발생하며, 설치 과정이 복잡

* 도커를 사용하는 이유
  * 도커를 이용하여 프로그램을 설치하면 예상치 못한 에러도 덜 발생하며, 설치하는 과정도 훨씬 간단해짐

* 도커없이 redis와 도커를 가지고 redis 설치 과정 비교

## 2. 도커란 무엇인가?
* 도커란 ?
  * **컨테이너**를 사용하여 응용프로그램을 더 쉽게 만들고 배포하고 실행할 수 있도록 설계된 도구 이며, **컨테이너** 기반의 오픈소스 가상화 플랫폼

* 서버에서의 컨테이너 개념
  * 다양한 프로그램, 실행환경을 컨테이너로 추상화하고 동일한 인터페이스를 제공하여 프로그램의 배포 및 관리를 단순하게 해준다.
  * 프로그램을 손쉽게 이동 배포 관리를 할 수 있게 해준다.(aws, azure, google cloud, ...)

## 3. 도커 이미지와 도커 컨테이너 정의
* 컨테이너 - 코드와 모든 종속성을 패키지화하여 응용 프로그램이 한 컴퓨터 환경에서 다른 컴퓨팅 환경으로 빠르고 안정적으로 실행되도록 하는 소프트웨어 표준 단위

* 컨테이너 이미지
  * 코드, 런타임, 시스템 도구, 시스템 라이브러리 및 설정과 같은 **응용 프로그램을 실행하는 데 필요한 모든 것을 포함**하는 가볍고 독립적이며 실행 가능한 소프트웨어 패키지
  * 컨테이너 이미지는 런타임에 컨테니어가 되고 도커 컨테이너의 경우 도커 엔진에서 실행될 때 이미지가 컨테이너가 된다
  * 리눅스와 윈도우 기반 애플리케이션 모두에서 사용할 수 있는 컨테이너화된 소프트웨어는 인프라에 관계없이 항상 동일하게 실행됨
  * 컨테이너는 **소프트웨어를 환경으로부터 격리시키고** 개발과 스테이징의 차이에도 불구하고 균일하게 작동하도록 보장

* 정리
  * 도커 이미지는 프로그램을 실행하는데 필요한 설정이나 종속성을 갖고 있으며, 도커 이미지를 이용해서 컨테이너 생성
  * 생성된 도커 컨테이너를 이용하여 프로그램을 실행

## 3. 도커 설치
### MAC
* [회원가입](https://hub.docker.com/signup) - 도커 사용시 필요
* [공홈에서 다운로드](https://www.docker.com/get-started)
* 설치확인
```
docker version
```

## 4. 도커를 사용할 때의 흐름
* cli에 커맨드 입력 => 도커 서버가 커맨드를 받아서 이미지를 생성하든 컨테이너를 실행하든 모든 작업을 하게됨
* 실행해보기
  1. 도커 프로그램 실행
  2. cli command
  ```
  docker run hello-world
  ```
  3. 도커 서버에 이미지 요청
  4. 도커 허브에서 이미지 확인

## 5. 도커와 기존의 가상화 기술과의 차이를 통한 컨테이너 이해
* 가상화 기술 나오기전
  * 한대의 서버를 하나의 용도로만 사용
  * 남는 서버 공간 방치
  * 하나의 서버에 하나의 운영체제, 하나의 프로그램만을 운영
  * 안정적이지만 비효율적

* 하이퍼 바이저 기반의 가상화 출현
  * 논리적으로 공간을 분할하여 VM이라는 독립적인 가상 환경의 서버 이용가능
  * 하이퍼 바이저는 호스트 시스템에서 다수의 게스트 OS를 구동할 수 있게 하는 소프트웨어, 그리고 하드웨어를 가상화하면서 하드웨어와 각각의 VM을 모니터링 하는 중간 관리자이다.

* 하이퍼 바이저
  * 네이티브 하이퍼 바이저
    * 하드웨어 => **하이퍼 바이저** => OS
    * 하드웨어를 직접 제어하기 때문에 자원을 효율적으로 사용가능
    * 별도의 호스트 OS가 없으므로 오버헤드가 적음
    * 여러 하드웨어 드라이버를 세팅해야 하기 때문에 설치가 어려움
  
  * 호스트형 하이퍼 바이저
    * 하드웨어 => OS => **하이퍼 바이저** => OS
    * 일반적인 호스트 OS위에서 실행됨
    * 하드웨어 자원을 VM 내부의 게스트 OS에 에뮬레이트 하는방식이므로 오버헤드가 크다
    * 게스트 OS 종류에 대한 제약이 없고, 구현이 쉽기 때문에 일반적으로 많이 이용

  * 하이퍼 바이저 기반의 VM 구조
    * 하이퍼 바이저에 의해 구동되는 VM은 각각의 VM마다 독립된 가상 하드웨어 자원을 할당 받음
    * 논리적으로 분리 되어 있어서 한 VM에 오류가 발생해도 다른 VM으로 퍼지지 않는다

* 가상화 기술(VM)에서 나온 컨테이너 가상화(Docker) 기술
  * 공통점 - 기본 하드웨어에서 격리된 환경 내의 애플리케이션을 배치하는 방법
  * 차이점 - 격리된 환경을 얼마나 격리를 시키는지의 차이
  * 도커 컨테이너
    * 하이퍼바이저와 게스트OS가 필요하지 않기 때문에 오버헤드가 적다(가볍다)
    * 호스트 OS위에 어플리케이션의 실행 패키지인 이미지만 배포하면 됨
    * 격리 기능 내부에 샌드박스가 있지만, 같은 호스트의 다른 컨테이너와 **동일한 커널을 공유**
    * 컨테이너 내부에서 실행되는 프로세스는 호스트 시스템(모든 프로세스를 나열 할 수 있는 충분한 권한이 있음)에서 볼 수 있다
    * ex - 도커와 함께 몽고DB 컨테이너를 시작하면 호스트의 일반 쉘에 ps-e grep 몽고를 실행하면 프로세스가 표시됨
  * VM
    * 어플리케이션을 실행 하기 위해서 VM을 띄우고, 자원을 할당한 다음, 게스트 OS를 부팅하여 어플리케이션을 실행해야 해서 훨씬 복잡하고 무겁게 실행
    * VM 내부에서 실행되는 모든 것은 호스트 운영체제 또는 하이퍼 바이저와 독립되어 있다
    * 가상머신
      * 가상 머신 플랫폼은 특정 VM에 대한 가상화 프로세스를 관리하기 위해 프로세스를 시작하고, 호스트 시스템은 그것의 하드웨어 자원의 일부를 할당한다.
      * 시작 시간에 VM 환경을 위해 새롭고 특정 VM만을 위한 커널을 부팅하고 운영 체제 프로세스 세트를 시작(VM의 크기를 훨씬 크게 만듬)
      * 맥에서 윈도우를 깐다던지 리눅스에서 윈도우를 돌린다던지 사용방법은 간단할 수 있지만 굉장히 느리다

* 어떻게 도커 컨테이너를 격리시킬까?
  * 리눅스에서 쓰이는 Cgroup(control group)과 네임스페이스(namespaces)에 대해 알아야 한다. 이것들이 컨테이너와 호스트에서 실행되는 다른 프로세스 사이에 벽을 만드는 리눅수 커널 기능들
    * C Group
      * CPU, 메모리, Network Bandwith, HD i/o 등 프로세스 그룹의 시스템 리소스 사용량을 관리
      * 어떤 어플 사용량이 많다면 C group에 집어 넣어서 CPU와 메모리 사용 제한 가능
    * 네임스페이스
      * 하나의 시스템에서 프로세스를 격리시킬 수 있는 가상화 기술
      * 별개의 독립된 공간을 사용하는 것처럼 격리된 환경을 제공하는 경량 프로세스 가상화 기술

## 6. 이미지로 컨테이너 만들기
* 시작하기전 기억해야 할 것 - 이미지는 응용 프로그램을 실행하는데 **필요한 모든 것**을 포함하고 있다.
* 필요한 모든 것
  * 시작시 실행 될 명령어
  * 파일 스냅샷(디렉토리나 파일을 카피 한 것)
* 이미지로 컨테이너 만드는 순서
  1. `docker run [docker image]`
  2. 도커 이미지에 있는 파일 스냅샷을 컨테이너 하드 디스크에 옮겨줌
  3. 이미지에서 가지고 있는 명령어(컨테이너가 실행될 때 사용될 명령어)를 이용해서 어플리케이션을 실행

## 7. C-group, 네임스페이스를 도커 환경에서 쓸 수 있는 이유
* C-group과 네임스페이스는 Linux에서만 사용 가능한데, 내가 사용하는 MAC OS나 window에서 어떻게 사용하는 것일까?
  * 리눅스 VM에서 도커가 실행된다.