## 클릭카운터 모듈 - 스펙1

- ClickCounter는 카운터 데이터를 다루는 모듈 (전역 공간에 있는 conter 변수를 ClickCounter 내부에서 관리하자)
- 첫번째 스펙 - "ClickCounter 모듈의 getValue()는 카운터 값을 반환한다."

  - red

  ```javascript
  describe("App.ClickCounter", () => {
    describe("getValue()", () => {
      it("초기값이 0인 카운터 값을 반환한다", () => {
        const counter = App.ClickCounter();
        expect(counter.getValue()).toBe(0);
      });
    });
  });
  ```

  - green

  ```javascript
  var App = App || {};

  App.ClickCounter = () => {
    return {
      getValue() {
        return 0;
      }
    };
  };
  ```

  - blue

  ```javascript
  var App = App || {};

  App.ClickCounter = () => {
    let value = 0;
    return {
      getValue() {
        return value;
      }
    };
  };
  ```

## 클릭카운터 모듈 - 스펙2

- beforeEach - it 함수 호출 직전에 실행되는 jasmine 함수이다. 중복코드를 beforeEach로 옮기자.

  - 실행순서

  ```javascript
  describe("components", () => {
    beforeEach(() => {}); // 첫번째
    afterEach(() => {}); // 세번째
    it("test1", () => {}); // 두번째
  });
  ```

- 두번째 스펙 - "ClickCounter 모듈의 increase()는 카운터 값을 1만큼 증가한다."

  - red

  ```javascript
  describe("increase()", () => {
    it("카운터를 1 올린다", () => {
      // 준비
      const counter = App.ClickCounter();
      // 실행
      counter.increase();
      // 단언
      expect(counter.getValue()).toBe(1);
    });
  });
  ```

  - green

  ```javascript
  var App = App || {};

  App.ClickCounter = () => {
    return {
      getValue() {
        return 0;
      },
      increase() {
        value++;
      }
    };
  };
  ```

  - blue - 초기값이 0이 아닐경우 increase() 실행결과가 1이 아닐수가 있다.

  ```javascript
  describe("increase()", () => {
    it("카운터를 1 올린다", () => {
      const initValue = counter.getValue();
      counter.increase();
      expect(counter.getValue()).toBe(initValue + 1);
    });
  });
  ```

## 클릭카운터 뷰 모듈 - 스펙1

- 카운터 데이터는 돔(DOM)에 반영되어야하기 때문에 ClickCountView 모듈 생성
- 데이터를 출력, 이벤트 핸들러를 바인딩하는 역할
- 테스트

  - TDD로 사고하면 필요한 **모듈을 주입**받아 사용
  - 하나의 기능 단위로 모듈을 분리할 수 있기 때문에 **단일 책임 원칙**을 지킬 수 있다.

  1. 데이터를 조회할 ClickCounter를 어떻게 얻을까 ?

  - ClickCounter는 객체를 만들어 파라미터로 전달 받자.

  2. 데이터를 출력할 돔 엘레멘트는 어떻게 테스트 할 까?

  - 데이터를 출력할 돔 엘레멘트도 만들어서 전달 받자.

  * red

  ```javascript
  describe("App.ClickCountView 모듈", () => {
    let clickCounter, updateEl, view;
    beforeEach(() => {
      clickCounter = App.ClickCounter();
      updateEl = document.createElement("span");
      view = App.ClickCountView(clickCounter, updateEl);
    });
    describe("updateView()는", () => {
      it("ClickCounter의 getValue() 값을 출력한다.", () => {
        const conterValue = clickCounter.getValue();
        view.updateView();
        expect(updateEl.innerHTML).toBe(counterValue.toString());
      });
    });
  });
  ```

  - green

  ```javascript
  var App = App || {};

  App.ClickCountView = (clickCounter, updateEl) => {
    return {
      updateView() {
        updateEl.innerHTML = clickCounter.getValue();
      }
    };
  };

  module.exports = App;
  ```

  - blue - ClickCountView 의존성 주입이 되었는지 어떻게 확인하지?

  ```javascript
  // ClickCountView.js
  App.ClickCountView = (clickCounter, updateEl) => {
    if (!clickCounter) throw Error("clickCounter");
    if (!updateEl) throw Error("updateEl");

    return {
      updateView() {
        updateEl.innerHTML = clickCounter.getValue();
      }
    };
  };

  // ClickCountView.spec.js
  it("clickCounter를 주입하지 않으면 에러를 던진다.", () => {
    clickCounter = null;
    const actual = () => ViewApp.ClickCountView(clickCounter, updateEl);
    expect(actual).toThrowError("clickCounter");
  });

  it("updateEl을 주입하지 않으면 에러를 던진다.", () => {
    updateEl = null;
    const actual = () => ViewApp.ClickCountView(clickCounter, updateEl);
    expect(actual).toThrowError("updateEl");
  });
  ```
